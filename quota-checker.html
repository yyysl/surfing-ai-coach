<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API é…é¢æ£€æŸ¥å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .btn {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .status-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4285f4;
        }
        
        .quota-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .quota-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .quota-number {
            font-size: 24px;
            font-weight: bold;
            color: #4285f4;
        }
        
        .quota-label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .tips {
            background: #e7f3ff;
            border: 1px solid #4285f4;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .tips h3 {
            color: #4285f4;
            margin-top: 0;
        }
        
        .tips ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .tips li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Gemini API é…é¢æ£€æŸ¥å™¨</h1>
            <p>æ£€æŸ¥ä½ çš„APIä½¿ç”¨æƒ…å†µå’Œé…é¢é™åˆ¶</p>
        </div>

        <div class="input-group">
            <label for="apiKeyInput">Gemini API Key:</label>
            <input type="password" id="apiKeyInput" placeholder="è¾“å…¥ä½ çš„Gemini API Key">
        </div>

        <div style="text-align: center;">
            <button class="btn" onclick="checkQuota()">æ£€æŸ¥é…é¢çŠ¶æ€</button>
            <button class="btn" onclick="testLightRequest()">æµ‹è¯•è½»é‡è¯·æ±‚</button>
        </div>

        <div class="status-panel" id="statusPanel" style="display: none;">
            <h3>é…é¢çŠ¶æ€</h3>
            <div id="statusContent"></div>
        </div>

        <div class="quota-info" id="quotaInfo" style="display: none;">
            <div class="quota-card">
                <div class="quota-number" id="dailyQuota">--</div>
                <div class="quota-label">æ¯æ—¥é…é¢</div>
            </div>
            <div class="quota-card">
                <div class="quota-number" id="usedQuota">--</div>
                <div class="quota-label">å·²ä½¿ç”¨</div>
            </div>
            <div class="quota-card">
                <div class="quota-number" id="remainingQuota">--</div>
                <div class="quota-label">å‰©ä½™é…é¢</div>
            </div>
            <div class="quota-card">
                <div class="quota-number" id="resetTime">--</div>
                <div class="quota-label">é‡ç½®æ—¶é—´</div>
            </div>
        </div>

        <div class="tips">
            <h3>ğŸ’¡ è§£å†³429é”™è¯¯çš„æ–¹æ³•</h3>
            <ul>
                <li><strong>ç­‰å¾…é‡ç½®ï¼š</strong>Geminiå…è´¹ç‰ˆæ¯åˆ†é’Ÿé™åˆ¶15æ¬¡è¯·æ±‚ï¼Œæ¯å¤©é™åˆ¶1500æ¬¡</li>
                <li><strong>å‡å°‘é¢‘ç‡ï¼š</strong>åœ¨è¯·æ±‚ä¹‹é—´å¢åŠ 3-5ç§’å»¶è¿Ÿ</li>
                <li><strong>ä¼˜åŒ–å†…å®¹ï¼š</strong>å‡å°‘maxOutputTokensï¼Œä½¿ç”¨æ›´ç®€æ´çš„æç¤ºè¯</li>
                <li><strong>åˆ†æ‰¹å¤„ç†ï¼š</strong>å°†å¤§é‡åˆ†æåˆ†æˆå°æ‰¹æ¬¡ï¼Œåˆ†æ—¶é—´æ®µè¿›è¡Œ</li>
                <li><strong>å‡çº§è´¦æˆ·ï¼š</strong>è€ƒè™‘å‡çº§åˆ°ä»˜è´¹ç‰ˆæœ¬è·å¾—æ›´é«˜é…é¢</li>
            </ul>
        </div>

        <div class="tips" style="background: #fff3cd; border-color: #ffc107;">
            <h3>âš ï¸ å½“å‰åº”ç”¨ä¼˜åŒ–</h3>
            <ul>
                <li>åˆ†æé—´éš”å·²è°ƒæ•´ä¸º4ç§’ï¼Œå‡å°‘APIè°ƒç”¨é¢‘ç‡</li>
                <li>æœ€å¤§åˆ†æå¸§æ•°é™åˆ¶ä¸º3å¸§ï¼Œé¿å…é…é¢è€—å°½</li>
                <li>æ·»åŠ äº†è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œé‡åˆ°429é”™è¯¯ä¼šè‡ªåŠ¨ç­‰å¾…é‡è¯•</li>
                <li>å‡å°‘äº†maxOutputTokensåˆ°500ï¼Œé™ä½å•æ¬¡æ¶ˆè€—</li>
            </ul>
        </div>
    </div>

    <script>
        let apiKey = '';

        async function checkQuota() {
            apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('è¯·è¾“å…¥API Key');
                return;
            }

            const statusPanel = document.getElementById('statusPanel');
            const statusContent = document.getElementById('statusContent');
            
            statusPanel.style.display = 'block';
            statusContent.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥é…é¢çŠ¶æ€...</p>';

            try {
                // å°è¯•ä¸€ä¸ªç®€å•çš„APIè°ƒç”¨æ¥æ£€æŸ¥çŠ¶æ€
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: "Hi" }]
                        }],
                        generationConfig: {
                            maxOutputTokens: 10
                        }
                    })
                });

                const headers = response.headers;
                const statusCode = response.status;

                if (statusCode === 429) {
                    statusContent.innerHTML = `
                        <p style="color: #d32f2f;"><strong>âŒ é…é¢å·²è¾¾ä¸Šé™</strong></p>
                        <p>é‡åˆ°429é”™è¯¯ï¼Œè¡¨ç¤ºAPIè¯·æ±‚é¢‘ç‡è¿‡é«˜æˆ–é…é¢å·²ç”¨å®Œã€‚</p>
                        <p><strong>å»ºè®®ï¼š</strong></p>
                        <ul>
                            <li>ç­‰å¾…1-2åˆ†é’Ÿåé‡è¯•ï¼ˆåˆ†é’Ÿçº§é™åˆ¶ï¼‰</li>
                            <li>å¦‚æœæŒç»­é‡åˆ°ï¼Œå¯èƒ½æ˜¯æ—¥é…é¢å·²æ»¡ï¼Œç­‰å¾…24å°æ—¶é‡ç½®</li>
                            <li>å‡å°‘åŒæ—¶è¿›è¡Œçš„åˆ†ææ•°é‡</li>
                        </ul>
                    `;
                } else if (response.ok) {
                    statusContent.innerHTML = `
                        <p style="color: #2e7d32;"><strong>âœ… APIå·¥ä½œæ­£å¸¸</strong></p>
                        <p>å½“å‰å¯ä»¥æ­£å¸¸è°ƒç”¨APIã€‚</p>
                    `;
                    
                    // æ˜¾ç¤ºé…é¢ä¿¡æ¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                    displayQuotaInfo(headers);
                } else {
                    const errorData = await response.json();
                    statusContent.innerHTML = `
                        <p style="color: #d32f2f;"><strong>âŒ APIé”™è¯¯</strong></p>
                        <p>çŠ¶æ€ç : ${statusCode}</p>
                        <p>é”™è¯¯ä¿¡æ¯: ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}</p>
                    `;
                }

            } catch (error) {
                statusContent.innerHTML = `
                    <p style="color: #d32f2f;"><strong>âŒ ç½‘ç»œé”™è¯¯</strong></p>
                    <p>${error.message}</p>
                `;
            }
        }

        async function testLightRequest() {
            apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('è¯·è¾“å…¥API Key');
                return;
            }

            console.log('å‘é€è½»é‡çº§æµ‹è¯•è¯·æ±‚...');
            
            try {
                const startTime = Date.now();
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: "æµ‹è¯•" }]
                        }],
                        generationConfig: {
                            maxOutputTokens: 5
                        }
                    })
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                const statusPanel = document.getElementById('statusPanel');
                const statusContent = document.getElementById('statusContent');
                
                statusPanel.style.display = 'block';

                if (response.status === 429) {
                    statusContent.innerHTML = `
                        <p style="color: #d32f2f;"><strong>âš ï¸ è½»é‡è¯·æ±‚ä¹Ÿè¢«é™åˆ¶</strong></p>
                        <p>å“åº”æ—¶é—´: ${responseTime}ms</p>
                        <p>å»ºè®®ç­‰å¾…æ›´é•¿æ—¶é—´å†å°è¯•ï¼Œæˆ–æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æ—¥é…é¢ä¸Šé™ã€‚</p>
                    `;
                } else if (response.ok) {
                    const data = await response.json();
                    statusContent.innerHTML = `
                        <p style="color: #2e7d32;"><strong>âœ… è½»é‡è¯·æ±‚æˆåŠŸ</strong></p>
                        <p>å“åº”æ—¶é—´: ${responseTime}ms</p>
                        <p>å“åº”å†…å®¹: ${data.candidates[0].content.parts[0].text}</p>
                        <p style="color: #4285f4;">APIçŠ¶æ€è‰¯å¥½ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼</p>
                    `;
                } else {
                    statusContent.innerHTML = `
                        <p style="color: #d32f2f;"><strong>âŒ è½»é‡è¯·æ±‚å¤±è´¥</strong></p>
                        <p>çŠ¶æ€ç : ${response.status}</p>
                        <p>å“åº”æ—¶é—´: ${responseTime}ms</p>
                    `;
                }

            } catch (error) {
                const statusPanel = document.getElementById('statusPanel');
                const statusContent = document.getElementById('statusContent');
                
                statusPanel.style.display = 'block';
                statusContent.innerHTML = `
                    <p style="color: #d32f2f;"><strong>âŒ è¯·æ±‚å¤±è´¥</strong></p>
                    <p>${error.message}</p>
                `;
            }
        }

        function displayQuotaInfo(headers) {
            // Gemini APIé€šå¸¸ä¸åœ¨å“åº”å¤´ä¸­æä¾›è¯¦ç»†çš„é…é¢ä¿¡æ¯
            // ä½†æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºä¸€äº›é€šç”¨ä¿¡æ¯
            const quotaInfo = document.getElementById('quotaInfo');
            quotaInfo.style.display = 'grid';
            
            // æ˜¾ç¤ºå·²çŸ¥çš„Geminiå…è´¹é…é¢ä¿¡æ¯
            document.getElementById('dailyQuota').textContent = '1,500';
            document.getElementById('usedQuota').textContent = 'æœªçŸ¥';
            document.getElementById('remainingQuota').textContent = 'æœªçŸ¥';
            
            // è®¡ç®—ä¸‹æ¬¡é‡ç½®æ—¶é—´ï¼ˆå‡è®¾ä¸ºUTCåˆå¤œï¼‰
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setUTCDate(tomorrow.getUTCDate() + 1);
            tomorrow.setUTCHours(0, 0, 0, 0);
            
            const hoursUntilReset = Math.ceil((tomorrow - now) / (1000 * 60 * 60));
            document.getElementById('resetTime').textContent = `${hoursUntilReset}å°æ—¶`;
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Gemini APIé…é¢æ£€æŸ¥å™¨å·²åŠ è½½');
        });
    </script>
</body>
</html>
