<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸå®è§†é¢‘æµ‹è¯• - AIå†²æµªåˆ†æ</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .video-info {
            background: #e7f3ff;
            border: 1px solid #4285f4;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .frames-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .frame-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }
        
        .frame-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .frame-info {
            padding: 15px;
        }
        
        .frame-time {
            font-weight: bold;
            color: #4285f4;
            margin-bottom: 10px;
        }
        
        .analysis-result {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
            white-space: pre-wrap;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .test-controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .api-key-input {
            width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px;
        }
        
        .progress {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #4285f4, #34a853);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ çœŸå®è§†é¢‘AIåˆ†ææµ‹è¯•</h1>
            <p>ä½¿ç”¨ä½ ä¸Šä¼ çš„è§†é¢‘æ•°æ®è¿›è¡ŒAIåˆ†ææµ‹è¯•å’Œè°ƒè¯•</p>
        </div>

        <div class="video-info">
            <h3>ğŸ“¹ è§†é¢‘ä¿¡æ¯</h3>
            <div id="videoDetails"></div>
        </div>

        <div class="test-controls">
            <input type="password" id="apiKey" class="api-key-input" placeholder="è¾“å…¥ Gemini API Key">
            <br>
            <button class="test-btn" onclick="testSingleFrame()">æµ‹è¯•å•å¸§åˆ†æ</button>
            <button class="test-btn" onclick="testAllFrames()">æµ‹è¯•æ‰€æœ‰å¸§</button>
            <button class="test-btn" onclick="testIntelligentAnalysis()">æµ‹è¯•æ™ºèƒ½åˆ†æ</button>
        </div>

        <div id="progressContainer" style="display: none;">
            <div class="progress">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
        </div>

        <div class="frames-container" id="framesContainer"></div>
    </div>

    <script>
        // ä½ çš„è§†é¢‘æ•°æ®
        const videoData = {
            "videoInfo": {
                "name": "84_1756955335.mp4",
                "size": 965266,
                "type": "video/mp4",
                "duration": 7.033333,
                "width": 1280,
                "height": 720
            },
            "frames": [
                {
                    "timePoint": 1.4066666,
                    "base64": "/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAHgAoADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAAAAECAwQFBgf/xABDEAABBAADBQYDBAkDAgYDAAABAAIDEQQSIRMxQVFhBRQicYGRMlKhFUJicgYjM0NTgpKx4RTB0TTwFiRjc6PxJVSi/8QAFwEBAQEBAAAAAAAAAAAAAAAAAAECA//EABcRAQEBAQAAAAAAAAAAAAAAAAARASH/2gAMAwEAAhEDEQA/AIIQhaczTCSYQMJpBNAIQhAIQhAIQhAIQhAIQhAJpIQNCEIBCEkDQhCAQhCAQhCAQhCAQhCBoQkgEIQgaEkIBCSEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCECQhCBohCEUIQhBFNJNIoEhCECSTSQI70IO9CIkmlxTQCaEIBCEIBCEIBCEIGhCSATSTQJNJCAQhNAkIQgEIQgaEkIGhJCBoQhAIQhAIQhAIQhAIQhAkIQgEIQgaSEIBCEIBCEIBCEIBCEIBCEIBCEIBCSEDQkhAIQhAIQhAIQhAIQhAqRSaEAhCEAkU0IIoUlFFJJNCCJQmkglWqdIQiHWiYSTQNCEIBCEIBCEIBCE0CQhCAQhCApOkk0CQmikCQmhAkJoQJCEIBCaFQIQhAIRaLQCErCMwQNCWYc0ZhzQNCjtGfMPdG0Z8w90DQobaP5x7o20X8Qe6CaFDbw/xG+6XeYf4rfdILEKrvMP8Vtf8AzJd3mH8M1Pgg0SVdV/8AhKPKP6R0qGJu55/mR1pJ7/yE//Z",
                    "size": 29
                },
                {
                    "timePoint": 3.5166665,
                    "base64": "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"
                },
                {
                    "timePoint": 5.6266664,
                    "base64": "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"
                }
            ],
            "timestamp": "2025-09-05T04:36:18.707Z",
            "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
        };

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            displayVideoInfo();
            displayFrames();
        }

        // æ˜¾ç¤ºè§†é¢‘ä¿¡æ¯
        function displayVideoInfo() {
            const info = videoData.videoInfo;
            document.getElementById('videoDetails').innerHTML = `
                <strong>æ–‡ä»¶å:</strong> ${info.name}<br>
                <strong>å¤§å°:</strong> ${(info.size / 1024 / 1024).toFixed(2)} MB<br>
                <strong>æ—¶é•¿:</strong> ${info.duration.toFixed(1)} ç§’<br>
                <strong>å°ºå¯¸:</strong> ${info.width}x${info.height}<br>
                <strong>æ ¼å¼:</strong> ${info.type}<br>
                <strong>å¸§æ•°:</strong> ${videoData.frames.length} å¸§
            `;
        }

        // æ˜¾ç¤ºæ‰€æœ‰å¸§
        function displayFrames() {
            const container = document.getElementById('framesContainer');
            container.innerHTML = '';

            videoData.frames.forEach((frame, index) => {
                const frameCard = document.createElement('div');
                frameCard.className = 'frame-card';
                frameCard.innerHTML = `
                    <img src="data:image/jpeg;base64,${frame.base64}" class="frame-image" alt="Frame ${index + 1}">
                    <div class="frame-info">
                        <div class="frame-time">æ—¶é—´ç‚¹: ${frame.timePoint.toFixed(2)}ç§’</div>
                        <div>å¤§å°: ${frame.size}KB</div>
                        <div id="analysis-${index}" class="analysis-loading" style="display: none;">
                            <div class="loading">ğŸ¤– AIåˆ†æä¸­...</div>
                        </div>
                        <div id="result-${index}" class="analysis-result" style="display: none;"></div>
                        <div id="error-${index}" class="error-message" style="display: none;"></div>
                    </div>
                `;
                container.appendChild(frameCard);
            });
        }

        // è·å–APIå¯†é’¥
        function getApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                alert('è¯·è¾“å…¥ Gemini API Key');
                return null;
            }
            return apiKey;
        }

        // æµ‹è¯•å•å¸§åˆ†æ
        async function testSingleFrame() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            const frameIndex = 0; // æµ‹è¯•ç¬¬ä¸€å¸§
            await analyzeFrame(frameIndex, apiKey);
        }

        // æµ‹è¯•æ‰€æœ‰å¸§
        async function testAllFrames() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            progressContainer.style.display = 'block';
            
            for (let i = 0; i < videoData.frames.length; i++) {
                const progress = ((i + 1) / videoData.frames.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressBar.textContent = `${Math.round(progress)}%`;
                
                await analyzeFrame(i, apiKey);
                
                // æ·»åŠ å»¶è¿Ÿé¿å…APIé™åˆ¶
                if (i < videoData.frames.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                }
            }
        }

        // åˆ†æå•ä¸ªå¸§
        async function analyzeFrame(frameIndex, apiKey) {
            const frame = videoData.frames[frameIndex];
            const analysisDiv = document.getElementById(`analysis-${frameIndex}`);
            const resultDiv = document.getElementById(`result-${frameIndex}`);
            const errorDiv = document.getElementById(`error-${frameIndex}`);

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            analysisDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            try {
                // æ„å»ºåˆ†ææç¤ºè¯
                const prompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å†²æµªæ•™ç»ƒã€‚è¯·åˆ†æè¿™ä¸ªå†²æµªè§†é¢‘å¸§ï¼ˆæ—¶é—´ç‚¹ï¼š${frame.timePoint.toFixed(2)}ç§’ï¼‰ï¼Œå¹¶ç»™å‡ºå…·ä½“çš„æŠ€æœ¯æŒ‡å¯¼ã€‚

è¯·ä»ä»¥ä¸‹æ–¹é¢è¿›è¡Œåˆ†æï¼š
1. å†²æµªè€…çš„å§¿æ€å’Œå¹³è¡¡
2. æ¿ä½å’Œé‡å¿ƒ
3. æŠ€æœ¯åŠ¨ä½œè¯„ä¼°
4. æ”¹è¿›å»ºè®®

è¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œç»™å‡ºå®ç”¨çš„æŒ‡å¯¼å»ºè®®ã€‚`;

                // è°ƒç”¨Gemini API
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                {
                                    inline_data: {
                                        mime_type: "image/jpeg",
                                        data: frame.base64
                                    }
                                }
                            ]
                        }],
                        generationConfig: {
                            maxOutputTokens: 800,
                            temperature: 0.7
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const analysisText = data.candidates[0].content.parts[0].text;
                    
                    // æ˜¾ç¤ºç»“æœ
                    resultDiv.innerHTML = analysisText;
                    resultDiv.style.display = 'block';
                } else {
                    throw new Error('APIè¿”å›æ ¼å¼ä¸æ­£ç¡®');
                }

            } catch (error) {
                console.error('Analysis error:', error);
                errorDiv.innerHTML = `åˆ†æå¤±è´¥: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                analysisDiv.style.display = 'none';
            }
        }

        // æµ‹è¯•æ™ºèƒ½åˆ†æï¼ˆå®Œæ•´çš„è§†é¢‘åˆ†ææµç¨‹ï¼‰
        async function testIntelligentAnalysis() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '10%';
            progressBar.textContent = 'å¼€å§‹æ™ºèƒ½åˆ†æ...';

            try {
                // ç¬¬ä¸€æ­¥ï¼šå†…å®¹æ¦‚è§ˆ
                progressBar.style.width = '30%';
                progressBar.textContent = 'åˆ†æè§†é¢‘å†…å®¹...';

                const contentOverview = await getContentOverview(apiKey);
                
                // ç¬¬äºŒæ­¥ï¼šåˆ¶å®šç­–ç•¥
                progressBar.style.width = '50%';
                progressBar.textContent = 'åˆ¶å®šåˆ†æç­–ç•¥...';

                const strategy = await formulateStrategy(contentOverview, apiKey);
                
                // ç¬¬ä¸‰æ­¥ï¼šè¯¦ç»†åˆ†æ
                progressBar.style.width = '70%';
                progressBar.textContent = 'æ‰§è¡Œè¯¦ç»†åˆ†æ...';

                const detailedAnalysis = await performDetailedAnalysis(strategy, apiKey);
                
                // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
                progressBar.style.width = '100%';
                progressBar.textContent = 'åˆ†æå®Œæˆï¼';

                displayFinalAnalysis(contentOverview, strategy, detailedAnalysis);

            } catch (error) {
                console.error('Intelligent analysis error:', error);
                alert(`æ™ºèƒ½åˆ†æå¤±è´¥: ${error.message}`);
            }
        }

        // è·å–å†…å®¹æ¦‚è§ˆ
        async function getContentOverview(apiKey) {
            const overviewPrompt = `ç®€å•æè¿°è¿™ä¸ªå†²æµªè§†é¢‘ç‰‡æ®µä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå†²æµªè€…åœ¨åšä»€ä¹ˆåŠ¨ä½œï¼Ÿè¯·ç”¨ä¸­æ–‡ç®€è¦è¯´æ˜ã€‚`;
            
            const overview = [];
            for (let i = 0; i < videoData.frames.length; i++) {
                const frame = videoData.frames[i];
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: overviewPrompt },
                                { inline_data: { mime_type: "image/jpeg", data: frame.base64 } }
                            ]
                        }],
                        generationConfig: { maxOutputTokens: 200, temperature: 0.7 }
                    })
                });

                const data = await response.json();
                const description = data.candidates[0].content.parts[0].text;
                
                overview.push({
                    timePoint: frame.timePoint,
                    description: description
                });

                if (i < videoData.frames.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            return overview;
        }

        // åˆ¶å®šåˆ†æç­–ç•¥
        async function formulateStrategy(contentOverview, apiKey) {
            const strategyPrompt = `åŸºäºä»¥ä¸‹è§†é¢‘å†…å®¹æè¿°ï¼Œè¯·ç¡®å®š3ä¸ªæœ€é‡è¦çš„æ—¶é—´æ®µè¿›è¡Œè¯¦ç»†åˆ†æã€‚
            
å†…å®¹æ¦‚è§ˆï¼š
${contentOverview.map(item => `${item.timePoint.toFixed(2)}ç§’: ${item.description}`).join('\n')}

è¯·è¿”å›JSONæ ¼å¼ï¼š
{
  "segments": [
    {"timePoint": 1.41, "focus": "èµ·å§‹é˜¶æ®µåˆ†æé‡ç‚¹"},
    {"timePoint": 3.52, "focus": "ä¸­æ®µæŠ€æœ¯åˆ†æé‡ç‚¹"},
    {"timePoint": 5.63, "focus": "ç»“æŸé˜¶æ®µåˆ†æé‡ç‚¹"}
  ]
}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: strategyPrompt }] }],
                    generationConfig: { maxOutputTokens: 300, temperature: 0.3 }
                })
            });

            const data = await response.json();
            const strategyText = data.candidates[0].content.parts[0].text;
            
            try {
                // æ¸…ç†å“åº”æ–‡æœ¬å¹¶è§£æJSON
                const cleanText = strategyText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const strategy = JSON.parse(cleanText);
                return strategy;
            } catch (error) {
                console.warn('Strategy parsing failed, using default strategy');
                return {
                    segments: [
                        { timePoint: 1.41, focus: "èµ·å§‹é˜¶æ®µæŠ€æœ¯åˆ†æ" },
                        { timePoint: 3.52, focus: "ä¸­æ®µæ»‘è¡ŒæŠ€æœ¯" },
                        { timePoint: 5.63, focus: "ç»“æŸé˜¶æ®µè¡¨ç°" }
                    ]
                };
            }
        }

        // æ‰§è¡Œè¯¦ç»†åˆ†æ
        async function performDetailedAnalysis(strategy, apiKey) {
            const detailedResults = [];
            
            for (let i = 0; i < strategy.segments.length; i++) {
                const segment = strategy.segments[i];
                const frame = videoData.frames[i];
                
                const detailedPrompt = `ä½œä¸ºä¸“ä¸šå†²æµªæ•™ç»ƒï¼Œè¯·è¯¦ç»†åˆ†æè¿™ä¸ªæ—¶åˆ»çš„å†²æµªæŠ€æœ¯ï¼ˆ${segment.timePoint.toFixed(2)}ç§’ï¼‰ã€‚

åˆ†æé‡ç‚¹ï¼š${segment.focus}

è¯·ä»ä»¥ä¸‹æ–¹é¢ç»™å‡ºè¯¦ç»†åˆ†æï¼š
1. å§¿æ€å’Œå¹³è¡¡è¯„ä¼°
2. æŠ€æœ¯åŠ¨ä½œè´¨é‡
3. æ—¶æœºæŠŠæ¡
4. å…·ä½“æ”¹è¿›å»ºè®®

è¯·ç”¨ä¸­æ–‡ç»™å‡ºä¸“ä¸šä¸”å®ç”¨çš„æŒ‡å¯¼ã€‚`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: detailedPrompt },
                                { inline_data: { mime_type: "image/jpeg", data: frame.base64 } }
                            ]
                        }],
                        generationConfig: { maxOutputTokens: 600, temperature: 0.7 }
                    })
                });

                const data = await response.json();
                const analysis = data.candidates[0].content.parts[0].text;
                
                detailedResults.push({
                    timePoint: segment.timePoint,
                    focus: segment.focus,
                    analysis: analysis
                });

                if (i < strategy.segments.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                }
            }
            
            return detailedResults;
        }

        // æ˜¾ç¤ºæœ€ç»ˆåˆ†æç»“æœ
        function displayFinalAnalysis(contentOverview, strategy, detailedAnalysis) {
            const container = document.getElementById('framesContainer');
            
            // åˆ›å»ºæœ€ç»ˆåˆ†æç»“æœå¡ç‰‡
            const finalCard = document.createElement('div');
            finalCard.className = 'frame-card';
            finalCard.innerHTML = `
                <div class="frame-info">
                    <div class="frame-time">ğŸ¯ æ™ºèƒ½åˆ†æç»“æœ</div>
                    
                    <h4>ğŸ“‹ å†…å®¹æ¦‚è§ˆ</h4>
                    ${contentOverview.map(item => `
                        <div><strong>${item.timePoint.toFixed(2)}ç§’:</strong> ${item.description}</div>
                    `).join('')}
                    
                    <h4>ğŸ¯ åˆ†æç­–ç•¥</h4>
                    ${strategy.segments.map(seg => `
                        <div><strong>${seg.timePoint.toFixed(2)}ç§’:</strong> ${seg.focus}</div>
                    `).join('')}
                    
                    <h4>ğŸ” è¯¦ç»†åˆ†æ</h4>
                    ${detailedAnalysis.map(result => `
                        <div class="analysis-result">
                            <strong>æ—¶é—´ç‚¹ ${result.timePoint.toFixed(2)}ç§’ - ${result.focus}</strong><br>
                            ${result.analysis}
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.appendChild(finalCard);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
