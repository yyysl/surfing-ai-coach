<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁúüÂÆûËßÜÈ¢ëÊµãËØï - AIÂÜ≤Êµ™ÂàÜÊûê</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .video-info {
            background: #e7f3ff;
            border: 1px solid #4285f4;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .frames-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .frame-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }
        
        .frame-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .frame-info {
            padding: 15px;
        }
        
        .frame-time {
            font-weight: bold;
            color: #4285f4;
            margin-bottom: 10px;
        }
        
        .analysis-result {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
            white-space: pre-wrap;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .test-controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .api-key-input {
            width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px;
        }
        
        .progress {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #4285f4, #34a853);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ ÁúüÂÆûËßÜÈ¢ëAIÂàÜÊûêÊµãËØï</h1>
            <p>‰ΩøÁî®‰Ω†‰∏ä‰º†ÁöÑËßÜÈ¢ëÊï∞ÊçÆËøõË°åAIÂàÜÊûêÊµãËØïÂíåË∞ÉËØï</p>
        </div>

        <div class="video-info">
            <h3>üìπ ËßÜÈ¢ë‰ø°ÊÅØ</h3>
            <div id="videoDetails"></div>
        </div>

        <div class="test-controls">
            <input type="password" id="apiKey" class="api-key-input" placeholder="ËæìÂÖ• Gemini API Key">
            <br>
            <button class="test-btn" onclick="testSingleFrame()">ÊµãËØïÂçïÂ∏ßÂàÜÊûê</button>
            <button class="test-btn" onclick="testAllFrames()">ÊµãËØïÊâÄÊúâÂ∏ß</button>
            <button class="test-btn" onclick="testIntelligentAnalysis()">ÊµãËØïÊô∫ËÉΩÂàÜÊûê</button>
        </div>

        <div id="progressContainer" style="display: none;">
            <div class="progress">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
        </div>

        <div class="frames-container" id="framesContainer"></div>
    </div>

    <script>
        // ‰Ω†ÁöÑËßÜÈ¢ëÊï∞ÊçÆ
        const videoData = {
            "videoInfo": {
                "name": "84_1756955335.mp4",
                "size": 965266,
                "type": "video/mp4",
                "duration": 7.033333,
                "width": 1280,
                "height": 720
            },
            "frames": [
                {
                    "timePoint": 1.4066666,
                    "base64": "/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAHgAoADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAAAAECAwQFBgf/xABDEAABBAADBQYDBAkDAgYDAAABAAIDEQQSIRMxQVFhBRQicYGRMlKhFUJicgYjM0NTgpKx4RTB0TTwFiRjc6PxJVSi/8QAFwEBAQEBAAAAAAAAAAAAAAAAAAECA//EABcRAQEBAQAAAAAAAAAAAAAAAAARASH/2gAMAwEAAhEDEQA/AIIQhaczTCSYQMJpBNAIQhAIQhAIQhAIQhAIQhAJpIQNCEIBCEkDQhCAQhCAQhCAQhCAQhCBoQkgEIQgaEkIBCSEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCECQhCBohCEUIQhBFNJNIoEhCECSTSQI70IO9CIkmlxTQCaEIBCEIBCEIBCEIGhCSATSTQJNJCAQhNAkIQgEIQgaEkIGhJCBoQhAIQhAIQhAIQhAIQhAkIQgEIQgaSEIBCEIBCEIBCEIBCEIBCEIBCEIBCSEDQkhAIQhAIQhAIQhAIQhAqRSaEAhCEAkU0IIoUlFFJJNCCJQmkglWqdIQiHWiYSTQNCEIBCEIBCEIBCE0CQhCAQhCApOkk0CQmikCQmhAkJoQJCEIBCaFQIQhAIRaLQCErCMwQNCWYc0ZhzQNCjtGfMPdG0Z8w90DQobaP5x7o20X8Qe6CaFDbw/xG+6XeYf4rfdILEKrvMP8Vtf8AzJd3mH8M1Pgg0SVdV/8AhKPKP6R0qGJu55/mR1pJ7/yE//Z",
                    "size": 29
                },
                {
                    "timePoint": 3.5166665,
                    "base64": "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"
                },
                {
                    "timePoint": 5.6266664,
                    "base64": "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"
                }
            ],
            "timestamp": "2025-09-05T04:36:18.707Z",
            "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
        };

        // ÂàùÂßãÂåñÈ°µÈù¢
        function initializePage() {
            displayVideoInfo();
            displayFrames();
        }

        // ÊòæÁ§∫ËßÜÈ¢ë‰ø°ÊÅØ
        function displayVideoInfo() {
            const info = videoData.videoInfo;
            document.getElementById('videoDetails').innerHTML = `
                <strong>Êñá‰ª∂Âêç:</strong> ${info.name}<br>
                <strong>Â§ßÂ∞è:</strong> ${(info.size / 1024 / 1024).toFixed(2)} MB<br>
                <strong>Êó∂Èïø:</strong> ${info.duration.toFixed(1)} Áßí<br>
                <strong>Â∞∫ÂØ∏:</strong> ${info.width}x${info.height}<br>
                <strong>Ê†ºÂºè:</strong> ${info.type}<br>
                <strong>Â∏ßÊï∞:</strong> ${videoData.frames.length} Â∏ß
            `;
        }

        // ÊòæÁ§∫ÊâÄÊúâÂ∏ß
        function displayFrames() {
            const container = document.getElementById('framesContainer');
            container.innerHTML = '';

            videoData.frames.forEach((frame, index) => {
                const frameCard = document.createElement('div');
                frameCard.className = 'frame-card';
                frameCard.innerHTML = `
                    <img src="data:image/jpeg;base64,${frame.base64}" class="frame-image" alt="Frame ${index + 1}">
                    <div class="frame-info">
                        <div class="frame-time">Êó∂Èó¥ÁÇπ: ${frame.timePoint.toFixed(2)}Áßí</div>
                        <div>Â§ßÂ∞è: ${frame.size}KB</div>
                        <div id="analysis-${index}" class="analysis-loading" style="display: none;">
                            <div class="loading">ü§ñ AIÂàÜÊûê‰∏≠...</div>
                        </div>
                        <div id="result-${index}" class="analysis-result" style="display: none;"></div>
                        <div id="error-${index}" class="error-message" style="display: none;"></div>
                    </div>
                `;
                container.appendChild(frameCard);
            });
        }

        // Ëé∑ÂèñAPIÂØÜÈí•
        function getApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                alert('ËØ∑ËæìÂÖ• Gemini API Key');
                return null;
            }
            return apiKey;
        }

        // ÊµãËØïÂçïÂ∏ßÂàÜÊûê
        async function testSingleFrame() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            const frameIndex = 0; // ÊµãËØïÁ¨¨‰∏ÄÂ∏ß
            await analyzeFrame(frameIndex, apiKey);
        }

        // ÊµãËØïÊâÄÊúâÂ∏ß
        async function testAllFrames() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            progressContainer.style.display = 'block';
            
            for (let i = 0; i < videoData.frames.length; i++) {
                const progress = ((i + 1) / videoData.frames.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressBar.textContent = `${Math.round(progress)}%`;
                
                await analyzeFrame(i, apiKey);
                
                // Ê∑ªÂä†Âª∂ËøüÈÅøÂÖçAPIÈôêÂà∂
                if (i < videoData.frames.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                }
            }
        }

        // ÂàÜÊûêÂçï‰∏™Â∏ß
        async function analyzeFrame(frameIndex, apiKey) {
            const frame = videoData.frames[frameIndex];
            const analysisDiv = document.getElementById(`analysis-${frameIndex}`);
            const resultDiv = document.getElementById(`result-${frameIndex}`);
            const errorDiv = document.getElementById(`error-${frameIndex}`);

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            analysisDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            try {
                // ÊûÑÂª∫ÂàÜÊûêÊèêÁ§∫ËØç
                const prompt = `‰Ω†ÊòØ‰∏Ä‰Ωç‰∏ì‰∏öÁöÑÂÜ≤Êµ™ÊïôÁªÉ„ÄÇËØ∑ÂàÜÊûêËøô‰∏™ÂÜ≤Êµ™ËßÜÈ¢ëÂ∏ßÔºàÊó∂Èó¥ÁÇπÔºö${frame.timePoint.toFixed(2)}ÁßíÔºâÔºåÂπ∂ÁªôÂá∫ÂÖ∑‰ΩìÁöÑÊäÄÊúØÊåáÂØº„ÄÇ

ËØ∑‰ªé‰ª•‰∏ãÊñπÈù¢ËøõË°åÂàÜÊûêÔºö
1. ÂÜ≤Êµ™ËÄÖÁöÑÂßøÊÄÅÂíåÂπ≥Ë°°
2. Êùø‰ΩçÂíåÈáçÂøÉ
3. ÊäÄÊúØÂä®‰ΩúËØÑ‰º∞
4. ÊîπËøõÂª∫ËÆÆ

ËØ∑Áî®‰∏≠ÊñáÂõûÁ≠îÔºåÁªôÂá∫ÂÆûÁî®ÁöÑÊåáÂØºÂª∫ËÆÆ„ÄÇ`;

                // Ë∞ÉÁî®Gemini API
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                {
                                    inline_data: {
                                        mime_type: "image/jpeg",
                                        data: frame.base64
                                    }
                                }
                            ]
                        }],
                        generationConfig: {
                            maxOutputTokens: 800,
                            temperature: 0.7
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`APIËØ∑Ê±ÇÂ§±Ë¥•: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const analysisText = data.candidates[0].content.parts[0].text;
                    
                    // ÊòæÁ§∫ÁªìÊûú
                    resultDiv.innerHTML = analysisText;
                    resultDiv.style.display = 'block';
                } else {
                    throw new Error('APIËøîÂõûÊ†ºÂºè‰∏çÊ≠£Á°Æ');
                }

            } catch (error) {
                console.error('Analysis error:', error);
                errorDiv.innerHTML = `ÂàÜÊûêÂ§±Ë¥•: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                analysisDiv.style.display = 'none';
            }
        }

        // ÊµãËØïÊô∫ËÉΩÂàÜÊûêÔºàÂÆåÊï¥ÁöÑËßÜÈ¢ëÂàÜÊûêÊµÅÁ®ãÔºâ
        async function testIntelligentAnalysis() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '10%';
            progressBar.textContent = 'ÂºÄÂßãÊô∫ËÉΩÂàÜÊûê...';

            try {
                // Á¨¨‰∏ÄÊ≠•ÔºöÂÜÖÂÆπÊ¶ÇËßà
                progressBar.style.width = '30%';
                progressBar.textContent = 'ÂàÜÊûêËßÜÈ¢ëÂÜÖÂÆπ...';

                const contentOverview = await getContentOverview(apiKey);
                
                // Á¨¨‰∫åÊ≠•ÔºöÂà∂ÂÆöÁ≠ñÁï•
                progressBar.style.width = '50%';
                progressBar.textContent = 'Âà∂ÂÆöÂàÜÊûêÁ≠ñÁï•...';

                const strategy = await formulateStrategy(contentOverview, apiKey);
                
                // Á¨¨‰∏âÊ≠•ÔºöËØ¶ÁªÜÂàÜÊûê
                progressBar.style.width = '70%';
                progressBar.textContent = 'ÊâßË°åËØ¶ÁªÜÂàÜÊûê...';

                const detailedAnalysis = await performDetailedAnalysis(strategy, apiKey);
                
                // ÊòæÁ§∫ÊúÄÁªàÁªìÊûú
                progressBar.style.width = '100%';
                progressBar.textContent = 'ÂàÜÊûêÂÆåÊàêÔºÅ';

                displayFinalAnalysis(contentOverview, strategy, detailedAnalysis);

            } catch (error) {
                console.error('Intelligent analysis error:', error);
                alert(`Êô∫ËÉΩÂàÜÊûêÂ§±Ë¥•: ${error.message}`);
            }
        }

        // Ëé∑ÂèñÂÜÖÂÆπÊ¶ÇËßà
        async function getContentOverview(apiKey) {
            const overviewPrompt = `ÁÆÄÂçïÊèèËø∞Ëøô‰∏™ÂÜ≤Êµ™ËßÜÈ¢ëÁâáÊÆµ‰∏≠ÂèëÁîü‰∫Ü‰ªÄ‰πàÔºüÂÜ≤Êµ™ËÄÖÂú®ÂÅö‰ªÄ‰πàÂä®‰ΩúÔºüËØ∑Áî®‰∏≠ÊñáÁÆÄË¶ÅËØ¥Êòé„ÄÇ`;
            
            const overview = [];
            for (let i = 0; i < videoData.frames.length; i++) {
                const frame = videoData.frames[i];
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: overviewPrompt },
                                { inline_data: { mime_type: "image/jpeg", data: frame.base64 } }
                            ]
                        }],
                        generationConfig: { maxOutputTokens: 200, temperature: 0.7 }
                    })
                });

                const data = await response.json();
                const description = data.candidates[0].content.parts[0].text;
                
                overview.push({
                    timePoint: frame.timePoint,
                    description: description
                });

                if (i < videoData.frames.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            return overview;
        }

        // Âà∂ÂÆöÂàÜÊûêÁ≠ñÁï•
        async function formulateStrategy(contentOverview, apiKey) {
            const strategyPrompt = `Âü∫‰∫é‰ª•‰∏ãËßÜÈ¢ëÂÜÖÂÆπÊèèËø∞ÔºåËØ∑Á°ÆÂÆö3‰∏™ÊúÄÈáçË¶ÅÁöÑÊó∂Èó¥ÊÆµËøõË°åËØ¶ÁªÜÂàÜÊûê„ÄÇ
            
ÂÜÖÂÆπÊ¶ÇËßàÔºö
${contentOverview.map(item => `${item.timePoint.toFixed(2)}Áßí: ${item.description}`).join('\n')}

ËØ∑ËøîÂõûJSONÊ†ºÂºèÔºö
{
  "segments": [
    {"timePoint": 1.41, "focus": "Ëµ∑ÂßãÈò∂ÊÆµÂàÜÊûêÈáçÁÇπ"},
    {"timePoint": 3.52, "focus": "‰∏≠ÊÆµÊäÄÊúØÂàÜÊûêÈáçÁÇπ"},
    {"timePoint": 5.63, "focus": "ÁªìÊùüÈò∂ÊÆµÂàÜÊûêÈáçÁÇπ"}
  ]
}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: strategyPrompt }] }],
                    generationConfig: { maxOutputTokens: 300, temperature: 0.3 }
                })
            });

            const data = await response.json();
            const strategyText = data.candidates[0].content.parts[0].text;
            
            try {
                // Ê∏ÖÁêÜÂìçÂ∫îÊñáÊú¨Âπ∂Ëß£ÊûêJSON
                const cleanText = strategyText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const strategy = JSON.parse(cleanText);
                return strategy;
            } catch (error) {
                console.warn('Strategy parsing failed, using default strategy');
                return {
                    segments: [
                        { timePoint: 1.41, focus: "Ëµ∑ÂßãÈò∂ÊÆµÊäÄÊúØÂàÜÊûê" },
                        { timePoint: 3.52, focus: "‰∏≠ÊÆµÊªëË°åÊäÄÊúØ" },
                        { timePoint: 5.63, focus: "ÁªìÊùüÈò∂ÊÆµË°®Áé∞" }
                    ]
                };
            }
        }

        // ÊâßË°åËØ¶ÁªÜÂàÜÊûê
        async function performDetailedAnalysis(strategy, apiKey) {
            const detailedResults = [];
            
            for (let i = 0; i < strategy.segments.length; i++) {
                const segment = strategy.segments[i];
                const frame = videoData.frames[i];
                
                const detailedPrompt = `‰Ωú‰∏∫‰∏ì‰∏öÂÜ≤Êµ™ÊïôÁªÉÔºåËØ∑ËØ¶ÁªÜÂàÜÊûêËøô‰∏™Êó∂ÂàªÁöÑÂÜ≤Êµ™ÊäÄÊúØÔºà${segment.timePoint.toFixed(2)}ÁßíÔºâ„ÄÇ

ÂàÜÊûêÈáçÁÇπÔºö${segment.focus}

ËØ∑‰ªé‰ª•‰∏ãÊñπÈù¢ÁªôÂá∫ËØ¶ÁªÜÂàÜÊûêÔºö
1. ÂßøÊÄÅÂíåÂπ≥Ë°°ËØÑ‰º∞
2. ÊäÄÊúØÂä®‰ΩúË¥®Èáè
3. Êó∂Êú∫ÊääÊè°
4. ÂÖ∑‰ΩìÊîπËøõÂª∫ËÆÆ

ËØ∑Áî®‰∏≠ÊñáÁªôÂá∫‰∏ì‰∏ö‰∏îÂÆûÁî®ÁöÑÊåáÂØº„ÄÇ`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: detailedPrompt },
                                { inline_data: { mime_type: "image/jpeg", data: frame.base64 } }
                            ]
                        }],
                        generationConfig: { maxOutputTokens: 600, temperature: 0.7 }
                    })
                });

                const data = await response.json();
                const analysis = data.candidates[0].content.parts[0].text;
                
                detailedResults.push({
                    timePoint: segment.timePoint,
                    focus: segment.focus,
                    analysis: analysis
                });

                if (i < strategy.segments.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                }
            }
            
            return detailedResults;
        }

        // ÊòæÁ§∫ÊúÄÁªàÂàÜÊûêÁªìÊûú
        function displayFinalAnalysis(contentOverview, strategy, detailedAnalysis) {
            const container = document.getElementById('framesContainer');
            
            // ÂàõÂª∫ÊúÄÁªàÂàÜÊûêÁªìÊûúÂç°Áâá
            const finalCard = document.createElement('div');
            finalCard.className = 'frame-card';
            finalCard.innerHTML = `
                <div class="frame-info">
                    <div class="frame-time">üéØ Êô∫ËÉΩÂàÜÊûêÁªìÊûú</div>
                    
                    <h4>üìã ÂÜÖÂÆπÊ¶ÇËßà</h4>
                    ${contentOverview.map(item => `
                        <div><strong>${item.timePoint.toFixed(2)}Áßí:</strong> ${item.description}</div>
                    `).join('')}
                    
                    <h4>üéØ ÂàÜÊûêÁ≠ñÁï•</h4>
                    ${strategy.segments.map(seg => `
                        <div><strong>${seg.timePoint.toFixed(2)}Áßí:</strong> ${seg.focus}</div>
                    `).join('')}
                    
                    <h4>üîç ËØ¶ÁªÜÂàÜÊûê</h4>
                    ${detailedAnalysis.map(result => `
                        <div class="analysis-result">
                            <strong>Êó∂Èó¥ÁÇπ ${result.timePoint.toFixed(2)}Áßí - ${result.focus}</strong><br>
                            ${result.analysis}
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.appendChild(finalCard);
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
